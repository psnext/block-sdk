(function(a){typeof define=="function"&&define.amd?define(a):a()})(function(){"use strict";var R=Object.defineProperty;var L=(a,o,l)=>o in a?R(a,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[o]=l;var i=(a,o,l)=>L(a,typeof o!="symbol"?o+"":o,l);for(var a=[],o=0;o<256;++o)a.push((o+256).toString(16).slice(1));function l(t,e=0){return(a[t[e+0]]+a[t[e+1]]+a[t[e+2]]+a[t[e+3]]+"-"+a[t[e+4]]+a[t[e+5]]+"-"+a[t[e+6]]+a[t[e+7]]+"-"+a[t[e+8]]+a[t[e+9]]+"-"+a[t[e+10]]+a[t[e+11]]+a[t[e+12]]+a[t[e+13]]+a[t[e+14]]+a[t[e+15]]).toLowerCase()}var r,D=new Uint8Array(16);function v(){if(!r&&(r=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(D)}var I=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const E={randomUUID:I};function y(t,e,s){if(E.randomUUID&&!e&&!t)return E.randomUUID();t=t||{};var n=t.random||(t.rng||v)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,l(n)}const d={OUTPUT:"output-event",INCOME:"input-event",CONTROLLER:"controller-event",HOST_DATA:"host-data-event",ALX:"alx-event"},A={BLOCK_ID:"block-id"},U="ALX",g={UPDATE_MESSAGE:"UPDATE_MESSAGE",DISPLAY_MESSAGE:"DISPLAY_MESSAGE"},k={RESIZE:"resize",READY:"ready"};function C(t,e){const s=new ResizeObserver(()=>{if(t){const{width:n,height:b}=t.getBoundingClientRect();e.sendControllerMessage({data:{width:n,height:b}},k.RESIZE)}});t&&s.observe(t)}function T(){return window.self!==window.top}function w(t){const e=y(),s=Date.now();window.parent.postMessage({senderBlockId:t.senderBlockId,type:t.type,namespace:t.namespace||"",eventData:{version:2,eventId:e,timestamp:s,playId:"",source:{blockId:t.senderBlockId,blockName:t.blockName,...t.source},payload:{...t.payload,lastUpdatedTimestamp:s},...t.eventData}},"*")}const c={isInIframe:T,sendMessageToHost:w,getUrlParams:t=>new URLSearchParams(window.location.search).get(t),domResizeObserver:C},u=class u{constructor(e,s){i(this,"blockName");i(this,"blockEventCallbacks");i(this,"blockId","");i(this,"hostData",{});this.blockName=e,this.blockEventCallbacks=s,this._setupDefaultParams(),this._setupWindowEvents()}_setupDefaultParams(){const e=c.getUrlParams(A.BLOCK_ID);if(!e)throw new Error("Not a valid block iframe");e&&(this.blockId=e)}_onPostMessageReceived(e){var s,n,b,m,h;((s=e.data)==null?void 0:s.receivingBlockId)===this.blockId&&(((n=e.data)==null?void 0:n.type)===d.INCOME?this.blockEventCallbacks.onIncomingData&&this.blockEventCallbacks.onIncomingData(e.data,e.data.eventData):((b=e.data)==null?void 0:b.type)===d.CONTROLLER?this.blockEventCallbacks.onControllerData&&this.blockEventCallbacks.onControllerData(e.data,e.data.eventData):((m=e.data)==null?void 0:m.type)===d.ALX?this.blockEventCallbacks.onAlxData&&this.blockEventCallbacks.onAlxData(e.data,e.data.eventData):((h=e.data)==null?void 0:h.type)===d.HOST_DATA&&(this.hostData={...this.hostData,...e.data.eventData.payload},this.blockEventCallbacks.onHostDataUpdate&&this.blockEventCallbacks.onHostDataUpdate(e.data,this.hostData)))}_setupWindowEvents(){window.addEventListener("message",this._onPostMessageReceived.bind(this))}static register(e,s){const n=new u(e,s);return n.sendControllerMessage(null,k.READY),n}sendOutput(e,s){c.sendMessageToHost({senderBlockId:this.blockId,type:d.OUTPUT,namespace:`${this.blockId}-${e}`,blockName:this.blockName,source:{handleId:e},payload:{data:s}})}sendAlxMessage(e,s=g.DISPLAY_MESSAGE){c.sendMessageToHost({senderBlockId:this.blockId,type:d.ALX,namespace:U,blockName:this.blockName,payload:{data:e},eventData:{alxEventType:s}})}resizeObserver(e){c.domResizeObserver(e,this)}sendControllerMessage(e,s){c.sendMessageToHost({senderBlockId:this.blockId,type:d.CONTROLLER,blockName:this.blockName,payload:{...e},eventData:{controllerType:s}})}};i(u,"Utils",{...c});let p=u;(function(t){t.BlockSdk=p})(window)});
//# sourceMappingURL=block-sdk.umd.cjs.map
